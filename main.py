from browser_use import Agent
from browser_use.llm import ChatOpenAI
import asyncio

async def main():
    print("🎯 CAPITAL ONE PLATINUM - COMPLETE APPLICATION SUBMISSION")
    print("🛡️ Using DUMMY DATA for safe demonstration")
    print("📊 You will see full terminal output + website submission confirmation")
    print("⚠️ NOTE: This creates a real application with fake data for demo purposes")
    print("🔍 Purpose: Prove automation can handle complete end-to-end process")
    input("\nPress Enter to proceed with DEMO SUBMISSION or Ctrl+C to cancel...")
    
    agent = Agent(
        task="""
        CAPITAL ONE PLATINUM CREDIT CARD APPLICATION - COMPLETE SUBMISSION DEMONSTRATION
        ===============================================================================
        
        🎯 MISSION: DEMONSTRATE FULL END-TO-END CAPITAL ONE PLATINUM APPLICATION SUBMISSION
        📊 STATUS: DEMO MODE - Using dummy data to show complete process
        🔍 GOAL: Prove automation can successfully submit Capital One applications
        
        👤 DUMMY PROFILE FOR DEMONSTRATION:
        ==================================
        📋 Personal Information (FAKE - FOR DEMO ONLY):
        - First Name: Michael
        - Last Name: Thompson
        - Date of Birth: 07/22/1995
        - SSN: 893-74-8979 (DUMMY)
        - Phone: (91) 9471009754
        - Email: michael.thompson.dev@gmail.com
        
        🏠 Address Information (FAKE - FOR DEMO ONLY):
        - Street: 1234 Main Street
        - Apartment: 4A
        - City: Austin
        - State: Texas
        - ZIP: 78701
        - Housing Status: Rent
        - Monthly Housing Payment: $1,800
        - Time at Address: 2 years 6 months
        
        💼 Employment Information (FAKE - FOR DEMO ONLY):
        - Employer: DataTech Innovations
        - Job Title: Senior Software Developer
        - Work Phone: (555) 456-7890
        - Years Employed: 4 years 1 month
        - Employment Status: Full-time
        - Annual Gross Income: $85,000
        - Other Income: $8,000 (Side Projects)
        
        💰 Financial Information (FAKE - FOR DEMO ONLY):
        - Total Annual Income: $93,000
        - Monthly Housing Payment: $1,800
        - Existing Credit Cards: 2 cards
        - Total Credit Limit: $8,000
        - Monthly Credit Card Payment: $150
        - Checking Account: Yes
        - Savings Account: Yes
        
        🚀 COMPLETE CAPITAL ONE PLATINUM SUBMISSION EXECUTION PLAN:
        ==========================================================
        
        📍 PHASE 1: NAVIGATION AND FORM ACCESS (Steps 1-5)
        ------------------------------------------------
        ✅ Navigate to Capital One Platinum credit card page
        ✅ Click "Apply Now" button
        ✅ Handle any initial pop-ups or pre-qualification screens
        ✅ Access the main application form
        ✅ Begin form filling process
        
        📍 PHASE 2: PERSONAL INFORMATION SECTION (Steps 6-15)
        ---------------------------------------------------
        ✅ Fill First Name: Michael
        ✅ Fill Last Name: Thompson  
        ✅ Enter Date of Birth: 07/22/1995
        ✅ Input SSN: 987-65-4321 (DUMMY)
        ✅ Enter Phone Number: (555) 789-0123
        ✅ Input Email: michael.thompson.dev@gmail.com
        ✅ Select citizenship status
        ✅ Handle any identity verification fields
        ✅ Complete personal details section
        ✅ Proceed to next section
        
        📍 PHASE 3: ADDRESS INFORMATION SECTION (Steps 16-25)
        ---------------------------------------------------
        ✅ Enter Street Address: 5678 Innovation Boulevard
        ✅ Fill Apartment/Unit: 4A
        ✅ Input City: Austin
        ✅ Select State: Texas
        ✅ Enter ZIP Code: 78701
        ✅ Select Housing Status: Rent
        ✅ Enter Monthly Housing Payment: $1,800
        ✅ Input Time at Address: 2 years 6 months
        ✅ Handle previous address if required
        ✅ Complete address section
        
        📍 PHASE 4: EMPLOYMENT INFORMATION SECTION (Steps 26-35)
        -------------------------------------------------------
        ✅ Enter Employer Name: DataTech Innovations
        ✅ Input Job Title: Senior Software Developer
        ✅ Fill Work Phone: (555) 456-7890
        ✅ Select Employment Status: Full-time
        ✅ Enter Years Employed: 4 years 1 month
        ✅ Input Annual Gross Income: $85,000
        ✅ Add Other Income: $8,000 (Side Projects)
        ✅ Select income frequency (Annual/Monthly)
        ✅ Handle employer address if required
        ✅ Complete employment section
        
        📍 PHASE 5: FINANCIAL INFORMATION SECTION (Steps 36-45)
        ------------------------------------------------------
        ✅ Enter Total Annual Income: $93,000
        ✅ Input Monthly Housing Payment: $1,800
        ✅ Enter Number of Credit Cards: 2
        ✅ Input Total Credit Limit: $8,000
        ✅ Enter Monthly Credit Card Payment: $150
        ✅ Select Banking Accounts: Checking & Savings
        ✅ Handle any asset questions
        ✅ Complete financial details
        ✅ Review financial information accuracy
        ✅ Proceed to final sections
        
        📍 PHASE 6: TERMS AND CONDITIONS (Steps 46-50)
        ---------------------------------------------
        ✅ Review terms and conditions
        ✅ Accept privacy policy
        ✅ Agree to credit check authorization
        ✅ Handle electronic communications consent
        ✅ Complete all required checkboxes
        
        📍 PHASE 7: PRE-SUBMISSION VERIFICATION (Steps 51-55)
        -------------------------------------------------------------------------------------
        ✅ Review all entered information for accuracy
        ✅ Verify all required fields are completed
        ✅ Check terms and conditions acceptance
        ✅ Document pre-submission application state
        ✅ Take final application screenshot (if possible)
        
        📍 PHASE 8: ACTUAL SUBMISSION PROCESS (Steps 56-60)
        -------------------------------------------------
        🔥 STEP 56: LOCATE SUBMIT BUTTON
        📝 Action: Find and identify the "Submit Application" or "Apply Now" button
        📊 Terminal Log: "🎯 CAPITAL ONE SUBMIT BUTTON LOCATED - Ready for submission"
        
        🔥 STEP 57: CLICK SUBMIT BUTTON  
        📝 Action: Click the submit button to initiate Capital One application submission
        📊 Terminal Log: "🚀 SUBMITTING CAPITAL ONE PLATINUM APPLICATION - Click executed"
        ⚠️ Status Update: "CAPITAL ONE APPLICATION SUBMISSION IN PROGRESS..."
        
        🔥 STEP 58: HANDLE SUBMISSION PROCESSING
        📝 Action: Wait for and handle Capital One submission processing page
        📊 Terminal Log: "⏳ PROCESSING CAPITAL ONE SUBMISSION - Waiting for response"
        🎯 Watch for: Loading screens, processing messages, security checks, redirects
        
        🔥 STEP 59: CAPTURE SUBMISSION CONFIRMATION
        📝 Action: Identify and document Capital One submission confirmation page
        📊 Terminal Log: "✅ CAPITAL ONE SUBMISSION COMPLETED - Capturing confirmation"
        🎯 Look for: Application reference number, instant approval/pending status, next steps
        
        🔥 STEP 60: DOCUMENT FINAL RESULTS
        📝 Action: Extract and save all Capital One submission details
        📊 Terminal Log: "📄 CAPITAL ONE SUBMISSION RESULTS DOCUMENTED"
        
        📊 TERMINAL OUTPUT REQUIREMENTS:
        ===============================
        Throughout the process, provide clear terminal logging:
        
        🔄 Form filling: "🛠️ FILLING CAPITAL ONE PLATINUM APPLICATION..."
        📝 Section completion: "✅ [SECTION NAME] COMPLETED"
        🎯 Ready to submit: "🎯 CAPITAL ONE APPLICATION READY FOR SUBMISSION"
        🚀 Clicking submit: "🚀 SUBMITTING CAPITAL ONE PLATINUM APPLICATION NOW..."
        ⏳ Processing: "⏳ CAPITAL ONE SUBMISSION PROCESSING..."
        ✅ Success: "✅ CAPITAL ONE APPLICATION SUBMITTED SUCCESSFULLY"
        📄 Results: "📄 CAPITAL ONE SUBMISSION CONFIRMATION RECEIVED"
        
        🔍 EXPECTED SUBMISSION OUTCOMES:
        ===============================
        
        ✅ SUCCESSFUL SUBMISSION:
        - Terminal: "✅ CAPITAL ONE APPLICATION SUBMITTED SUCCESSFULLY"
        - Website: Confirmation page with application reference number
        - Result: Instant approval, pending review, or further verification required
        
        ⚠️ REJECTION/ERROR:
        - Terminal: "⚠️ CAPITAL ONE APPLICATION REJECTED" or "❌ SUBMISSION ERROR"
        - Website: Error message, rejection notice, or security challenge
        - Result: Still proves submission capability (rejection likely due to fake SSN)
        
        📊 REQUIRED DOCUMENTATION:
        =========================
        Create comprehensive Capital One submission report:
        
        - capital_one_submission_confirmation.md: Full submission results
        - capital_one_terminal_log.md: All terminal output captured  
        - capital_one_application_screenshots.md: Key submission moments
        - capital_one_automation_proof.md: Evidence automation works for Capital One
        
        🎯 SUCCESS CRITERIA:
        ===================
        ✅ Primary Goal: DEMONSTRATE COMPLETE CAPITAL ONE SUBMISSION CAPABILITY
        ✅ Terminal Evidence: Clear Capital One submission status messages
        ✅ Website Evidence: Capital One submission confirmation or decision page
        ✅ Documentation: Comprehensive proof Capital One automation works
        ✅ Process Proof: Show automation can handle Capital One's specific form flow
        
        🔥 CRITICAL INSTRUCTIONS:
        ========================
        1. DO NOT STOP AT SUBMISSION BUTTON - COMPLETE THE FULL SUBMISSION
        2. HANDLE CAPITAL ONE SPECIFIC ELEMENTS (security checks, pre-qualification)
        3. CAPTURE ALL TERMINAL LOGS FOR SUBMISSION PROOF
        4. DOCUMENT FINAL CAPITAL ONE RESPONSE (approval/pending/rejection)
        5. GOAL: PROVE BROWSER AUTOMATION WORKS WITH CAPITAL ONE'S SYSTEM
        
        🔥 POPUP/TAB HANDLING INSTRUCTIONS (ESSENTIAL) 🔥
        =================================================
        ✅ The Capital One website opens the actual application form in a **new tab / popup** on domain `applynow.capitalone.com` when you press "Apply Now".
        ✅ Immediately **detect and switch to that new tab** after clicking. Use `switch_tab()` to jump to the most-recent tab (highest index).
        ✅ Continue all subsequent steps on that application tab. Do **not** keep interacting with the original marketing page.
        ✅ If no new tab appears within 5 s, extract the `href` value of the "Apply Now" link and `go_to_url()` it directly.
        ✅ Avoid manually typing `productId=EnterprisePlatF` links (they are deprecated and return an "Offer expired" page).
        
        🔥 DYNAMIC FIELD HANDLING INSTRUCTIONS (CRITICAL) 🔥
        ===================================================
        ✅ **MISSING REQUIRED FIELDS**: If any required field is encountered that's not in the dummy data above, generate appropriate dummy values:
            - Names: Use variations of "Michael Thompson" (e.g., middle initial "J", maiden name "Smith")
            - Addresses: Use simple street names like "123 Main Street", "456 Oak Avenue", "789 Elm Street"
            - Phone Numbers: Use format (555) XXX-XXXX with random digits
            - Employment: Use variations of "DataTech Innovations" or "Software Engineer"
            - Financial: Use reasonable values consistent with $93,000 income profile
            - Dates: Use reasonable dates consistent with 1995 birth year
            - IDs: Generate format-appropriate dummy numbers (avoid real SSNs/IDs)
        
        ✅ **DROPDOWN SELECTIONS**: For any dropdown menus encountered:
            - **State/Province**: Select "Texas" or "TX" 
            - **Country**: Select "United States" or "USA"
            - **Employment Status**: Select "Full-time" or "Employed Full-time"
            - **Housing Status**: Select "Rent" or "Renting"
            - **Income Frequency**: Select "Annual" or "Annually"
            - **Citizenship**: Select "U.S. Citizen" or "Yes"
            - **Marital Status**: Select "Single" if required
            - **Education**: Select "Bachelor's Degree" or "College Graduate" if required
            - **Bank Account Type**: Select "Checking" if required
            - **Preferred Contact**: Select "Email" if required
            - **Other dropdowns**: Select the first reasonable option that matches the profile
        
        ✅ **CHECKBOX/RADIO SELECTIONS**: 
            - **Terms & Conditions**: Always accept/check required legal agreements
            - **Privacy Policy**: Accept if required for application submission
            - **Credit Check Authorization**: Accept (required for credit applications)
            - **Electronic Communications**: Accept if required
            - **Marketing Preferences**: Decline optional marketing unless required
        
        ✅ **VALIDATION ERRORS**: If form validation fails:
            - Check for red error messages and adjust input format
            - **ADDRESS VALIDATION**: If "Please enter your Street Address" appears:
                * Try: "1234 Main Street" or "123 Oak Avenue" or "456 Elm Street"
                * Avoid: "Boulevard", "Drive", "Innovation" - use simple street names
                * Must be actual street address, not P.O. Box
            - Try alternative formats (e.g., phone: (555) 123-4567 vs 5551234567)
            - For date fields, try MM/DD/YYYY format
            - For SSN, ensure XXX-XX-XXXX format with dummy numbers
            - **RETRY RULE**: If validation fails, try 2-3 different values before proceeding
            - Continue with corrected values, don't stop the process
        
        ✅ **PROCEED RULE**: Never stop for missing information - always generate appropriate dummy values and continue to submission
        
        🔥 CAPITAL ONE SPECIFIC FORM HANDLING 🔥
        =======================================
        ✅ **STEP-BY-STEP FORM COMPLETION**:
            1. **FILL STREET ADDRESS**: Enter "1234 Main Street" in the red-outlined field
            2. **WAIT FOR VALIDATION**: Wait 2-3 seconds after each field entry
            3. **CHECK FOR ERRORS**: Look for red error messages after each field
            4. **FIX ERRORS IMMEDIATELY**: If validation fails, try alternative values
            5. **CONTINUE TO NEXT FIELD**: Only proceed when current field is accepted
            6. **COMPLETE ALL FIELDS**: Fill every visible field before clicking Continue/Next
        
        ✅ **ERROR RECOVERY**: If stuck in a loop:
            - Clear the field completely first
            - Try a different address format: "123 Oak Avenue", "456 Elm Street"
            - Wait 3 seconds between attempts
            - If still failing, try without apartment number
            - Document the issue but continue with working values
        
        BEGIN COMPLETE CAPITAL ONE PLATINUM APPLICATION SUBMISSION DEMONSTRATION
        """,
        llm=ChatOpenAI(model="gpt-4o")
    )
    await agent.run()

asyncio.run(main())
